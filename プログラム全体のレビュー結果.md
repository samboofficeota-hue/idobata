# ãƒ—ãƒ­ã‚°ãƒ©ãƒ å…¨ä½“ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ

## 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å›ç­” â†’ ãƒ‡ãƒ¼ã‚¿ä¿å­˜

### ãƒ•ãƒ­ãƒ¼
1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒãƒ£ãƒƒãƒˆã§æ„è¦‹ã‚’æŠ•ç¨¿**
   - ãƒ•ã‚¡ã‚¤ãƒ«: `idea-discussion/backend/controllers/chatController.js`
   - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `POST /api/themes/:themeId/chat/messages`
   - ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒ`ChatThread`ã«ä¿å­˜ã•ã‚Œã‚‹

2. **AIãŒæ„è¦‹ã‹ã‚‰Problem/Solutionã‚’æŠ½å‡º**
   - ãƒ•ã‚¡ã‚¤ãƒ«: `idea-discussion/backend/workers/extractionWorker.js`
   - `Problem`ãƒ¢ãƒ‡ãƒ«ã¨`Solution`ãƒ¢ãƒ‡ãƒ«ã«ä¿å­˜
   - `statement`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«èª²é¡Œ/è§£æ±ºç­–ã®ãƒ†ã‚­ã‚¹ãƒˆãŒä¿å­˜ã•ã‚Œã‚‹
   - äºŒæ–‡æ§‹æˆã§è¨˜è¿°ï¼ˆä¸»èªæ˜ç¢ºåŒ–ã€èƒŒæ™¯æƒ…å ±ã‚’å«ã‚€ï¼‰

3. **QuestionLinkã§é–¢é€£ä»˜ã‘**
   - ãƒ•ã‚¡ã‚¤ãƒ«: `idea-discussion/backend/models/QuestionLink.js`
   - `questionId`ã¨`linkedItemId`ï¼ˆProblem/Solutionã®IDï¼‰ã§é–¢é€£ä»˜ã‘
   - `relevanceScore`ã§é–¢é€£åº¦ã‚’è¨˜éŒ²ï¼ˆ0-1ã®å€¤ï¼‰

### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
- **Problem**: `{ _id, statement, sourceType, sourceOriginId, ... }`
- **Solution**: `{ _id, statement, sourceType, sourceOriginId, ... }`
- **QuestionLink**: `{ questionId, linkedItemId, linkedItemType, relevanceScore }`

### âœ… ç¢ºèªçµæœ
- ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼: æ­£å¸¸
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°: æ­£å¸¸
- é–¢é€£ä»˜ã‘ãƒ­ã‚¸ãƒƒã‚¯: æ­£å¸¸

---

## 2. AIã¸ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ

### 2.1 è«–ç‚¹ã¾ã¨ã‚ï¼ˆDebateAnalysisï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `idea-discussion/backend/services/debateAnalysisGenerator.js`

#### ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ17-66è¡Œç›®ï¼‰
```javascript
// 1. Questionã‚’å–å¾—
const question = await SharpQuestion.findById(questionId);

// 2. QuestionLinkã‹ã‚‰é–¢é€£ã™ã‚‹Problem/Solutionã®IDã‚’å–å¾—
const links = await QuestionLink.find({ questionId: questionId });
const problemLinks = links.filter(link => link.linkedItemType === "problem");
const solutionLinks = links.filter(link => link.linkedItemType === "solution");

// 3. relevanceScoreã§ã‚½ãƒ¼ãƒˆ
problemLinks.sort((a, b) => (b.relevanceScore || 0) - (a.relevanceScore || 0));
solutionLinks.sort((a, b) => (b.relevanceScore || 0) - (a.relevanceScore || 0));

// 4. Problem/Solutionã®statementã‚’å–å¾—
const problemStatements = sortedProblems.map((p) => p.statement);
const solutionStatements = sortedSolutions.map((s) => s.statement);
```

#### Markdownã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆï¼ˆ68-76è¡Œç›®ï¼‰
```javascript
const markdownContent = `
# ${question.questionText}

## èª²é¡Œç‚¹
${problemStatements.map((statement, index) => `${index + 1}. ${statement}`).join("\n")}

## è§£æ±ºç­–
${solutionStatements.map((statement, index) => `${index + 1}. ${statement}`).join("\n")}
`;
```

#### LLMå‘¼ã³å‡ºã—ï¼ˆ78-180è¡Œç›®ï¼‰
- JSONå½¢å¼ã§å‡ºåŠ›ã‚’è¦æ±‚
- å‡ºåŠ›æ§‹é€ : `{ axes: [...], agreementPoints: [...], disagreementPoints: [...] }`

### 2.2 æ„è¦‹ã¾ã¨ã‚ï¼ˆDigestDraftï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `idea-discussion/backend/workers/digestGenerator.js`

#### ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ9-64è¡Œç›®ï¼‰
- è«–ç‚¹ã¾ã¨ã‚ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã§Problem/Solutionã‚’å–å¾—
- **è¿½åŠ **: `PolicyDraft`ã®å­˜åœ¨ç¢ºèªï¼ˆ68-79è¡Œç›®ï¼‰
  - `PolicyDraft`ãŒå­˜åœ¨ã—ãªã„å ´åˆã€ç”Ÿæˆã‚’ã‚¹ã‚­ãƒƒãƒ—

#### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼ˆ84-140è¡Œç›®ï¼‰
- **é‡è¦**: Markdownã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æ§‹é€ æŒ‡å®šï¼ˆ113-118è¡Œç›®ï¼‰
  - ã‚¿ã‚¤ãƒˆãƒ«ã€Œå¸‚æ°‘ã®æ„è¦‹ãƒ¬ãƒãƒ¼ãƒˆã€ã‚’å«ã‚ãªã„
  - ã€Œå•ã„ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å«ã‚ãªã„
  - ã€Œæ¦‚è¦ã€â†’ã€Œã¾ã¨ã‚ã€ã«å¤‰æ›´
  - ã€Œä¸»è¦ãªèª²é¡Œã€ã‚’ä½¿ç”¨

#### LLMå‘¼ã³å‡ºã—ï¼ˆ142-143è¡Œç›®ï¼‰
- JSONå½¢å¼ã§å‡ºåŠ›ã‚’è¦æ±‚
- å‡ºåŠ›æ§‹é€ : `{ title: string, content: string }`

### 2.3 ã‚¤ãƒ©ã‚¹ãƒˆè¦ç´„ï¼ˆVisualReportï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `idea-discussion/backend/services/questionVisualReportGenerator.js`

#### ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ15-64è¡Œç›®ï¼‰
- è«–ç‚¹ã¾ã¨ã‚ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã§Problem/Solutionã‚’å–å¾—

#### Markdownã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆï¼ˆ66-74è¡Œç›®ï¼‰
- è«–ç‚¹ã¾ã¨ã‚ã¨åŒã˜å½¢å¼

#### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼ˆ76-149è¡Œç›®ï¼‰
- **ãƒ˜ãƒƒãƒ€ãƒ¼ä»•æ§˜**: å³ä¸Šã«å°ã•ãã€Œï¼ˆä»Šæ—¥ã®æ—¥ä»˜ï¼‰ï¼ï¼ˆå•ã„ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼‰ã€
- **ãƒ•ãƒƒã‚¿ãƒ¼ä»•æ§˜**: ã€Œidobata by DD2030ã€
- **æ—¥ä»˜**: å®Ÿéš›ã®æ—¥ä»˜ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å«ã‚ã‚‹ï¼ˆä¿®æ­£æ¸ˆã¿ï¼‰

#### LLMå‘¼ã³å‡ºã—ï¼ˆ154-158è¡Œç›®ï¼‰
- HTMLå½¢å¼ã§å‡ºåŠ›ï¼ˆJSONã§ã¯ãªã„ï¼‰

### 2.4 æ”¿ç­–ãƒ‰ãƒ©ãƒ•ãƒˆï¼ˆPolicyDraftï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `idea-discussion/backend/workers/policyGenerator.js`

#### ãƒ‡ãƒ¼ã‚¿å–å¾—
- è«–ç‚¹ã¾ã¨ã‚ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã§Problem/Solutionã‚’å–å¾—

#### LLMå‘¼ã³å‡ºã—
- JSONå½¢å¼ã§å‡ºåŠ›ã‚’è¦æ±‚
- å‡ºåŠ›æ§‹é€ : `{ title: string, content: string }`
- å†…å®¹: ãƒ“ã‚¸ãƒ§ãƒ³ãƒ¬ãƒãƒ¼ãƒˆã¨è§£æ±ºæ‰‹æ®µãƒ¬ãƒãƒ¼ãƒˆã®2ãƒ‘ãƒ¼ãƒˆ

### âœ… ç¢ºèªçµæœ
- ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ­ã‚¸ãƒƒã‚¯: ã™ã¹ã¦åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ä¸€è²«æ€§ã‚ã‚Š
- relevanceScoreã§ã®ã‚½ãƒ¼ãƒˆ: æ­£å¸¸
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹é€ : å„ãƒ¬ãƒãƒ¼ãƒˆã‚¿ã‚¤ãƒ—ã§é©åˆ‡ã«è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹

---

## 3. AIã‹ã‚‰ã®ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ â†’ ãƒ‡ãƒ¼ã‚¿ä¿å­˜

### 3.1 è«–ç‚¹ã¾ã¨ã‚ï¼ˆDebateAnalysisï¼‰

**ãƒ¢ãƒ‡ãƒ«**: `idea-discussion/backend/models/DebateAnalysis.js`
```javascript
{
  questionId: ObjectId,
  axes: [{ title: string, options: [{ label: string, description: string }] }],
  agreementPoints: [string],
  disagreementPoints: [string],
  version: number
}
```

**ä¿å­˜å‡¦ç†**: `debateAnalysisGenerator.js`ï¼ˆ164-180è¡Œç›®ï¼‰
- LLMã®JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãã®ã¾ã¾ä¿å­˜

### 3.2 æ„è¦‹ã¾ã¨ã‚ï¼ˆDigestDraftï¼‰

**ãƒ¢ãƒ‡ãƒ«**: `idea-discussion/backend/models/DigestDraft.js`
```javascript
{
  questionId: ObjectId,
  policyDraftId: ObjectId,
  title: string,
  content: string,  // Markdownå½¢å¼
  sourceProblemIds: [ObjectId],
  sourceSolutionIds: [ObjectId],
  version: number
}
```

**ä¿å­˜å‡¦ç†**: `digestGenerator.js`ï¼ˆ164-177è¡Œç›®ï¼‰
- LLMã®JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆtitle, contentï¼‰ã‚’ä¿å­˜

### 3.3 ã‚¤ãƒ©ã‚¹ãƒˆè¦ç´„ï¼ˆQuestionVisualReportï¼‰

**ãƒ¢ãƒ‡ãƒ«**: `idea-discussion/backend/models/QuestionVisualReport.js`
```javascript
{
  questionId: ObjectId,
  questionText: string,
  overallAnalysis: string,  // HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  sourceProblemIds: [ObjectId],
  sourceSolutionIds: [ObjectId],
  version: number
}
```

**ä¿å­˜å‡¦ç†**: `questionVisualReportGenerator.js`ï¼ˆ174-184è¡Œç›®ï¼‰
- LLMã®HTMLãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»ã—ã¦ä¿å­˜

### 3.4 æ”¿ç­–ãƒ‰ãƒ©ãƒ•ãƒˆï¼ˆPolicyDraftï¼‰

**ãƒ¢ãƒ‡ãƒ«**: `idea-discussion/backend/models/PolicyDraft.js`
```javascript
{
  questionId: ObjectId,
  title: string,
  content: string,  // Markdownå½¢å¼ï¼ˆãƒ“ã‚¸ãƒ§ãƒ³ãƒ¬ãƒãƒ¼ãƒˆã¨è§£æ±ºæ‰‹æ®µãƒ¬ãƒãƒ¼ãƒˆï¼‰
  sourceProblemIds: [ObjectId],
  sourceSolutionIds: [ObjectId],
  version: number
}
```

### âœ… ç¢ºèªçµæœ
- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«: é©åˆ‡ã«è¨­è¨ˆã•ã‚Œã¦ã„ã‚‹
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†: ã™ã¹ã¦ã®ãƒ¢ãƒ‡ãƒ«ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- ä¿å­˜å‡¦ç†: æ­£å¸¸

---

## 4. è¡¨ç¤ºå®Ÿè£…

### 4.1 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API

#### å–å¾—API
**ãƒ•ã‚¡ã‚¤ãƒ«**: `idea-discussion/backend/controllers/questionController.js`
**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/themes/:themeId/questions/:questionId/details`
**è¡Œæ•°**: 109-263è¡Œç›®

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ **ï¼ˆ237-255è¡Œç›®ï¼‰:
```javascript
{
  question: { ...question, voteCount },
  relatedProblems: [...],  // relevanceScoreä»˜ã
  relatedSolutions: [...],  // relevanceScoreä»˜ã
  debateData: {
    axes: [...],
    agreementPoints: [...],
    disagreementPoints: [...]
  } | null,
  digestDraft: {
    title: string,
    content: string,
    createdAt: string
  } | null,
  visualReport: string | null,  // overallAnalysis
  participantCount: number,
  dialogueCount: number
}
```

#### ç”Ÿæˆãƒˆãƒªã‚¬ãƒ¼API
- `POST /api/themes/:themeId/questions/:questionId/generate-policy`
- `POST /api/themes/:themeId/questions/:questionId/generate-debate-analysis`
- `POST /api/themes/:themeId/questions/:questionId/generate-digest`
- `POST /api/themes/:themeId/questions/:questionId/generate-visual-report`

**ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: `idea-discussion/backend/routes/themeQuestionRoutes.js`

### 4.2 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

#### ãƒ‡ãƒ¼ã‚¿å–å¾—
**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/hooks/useQuestionDetail.ts`
**å‹å®šç¾©**ï¼ˆ5-30è¡Œç›®ï¼‰:
```typescript
export interface QuestionDetailResponse {
  question: Question & { voteCount: number };
  debateData: {
    axes: [{ title: string; options: [{ label: string; description: string }] }];
    agreementPoints: string[];
    disagreementPoints: string[];
  } | null;
  relatedProblems: RelatedProblem[];
  relatedSolutions: RelatedSolution[];
  digestDraft: {
    title: string;
    content: string;
    createdAt: string;
  } | null;
  visualReport: string;  // â† overallAnalysisãŒã“ã“ã«ãƒãƒƒãƒ”ãƒ³ã‚°
  participantCount?: number;
  dialogueCount?: number;
}
```

**APIå‘¼ã³å‡ºã—**ï¼ˆ43è¡Œç›®ï¼‰:
```typescript
const result = await apiClient.getQuestionDetails(questionId, themeId);
```

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/services/api/apiClient.ts`
**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `/themes/${themeId}/questions/${questionId}/details`ï¼ˆ140è¡Œç›®ï¼‰

#### è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**QuestionDetail.tsx**ï¼ˆ246-281è¡Œç›®ï¼‰
- **ã¿ã‚“ãªã®è«–ç‚¹**: `DebatePointsContent`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ267è¡Œç›®ï¼‰
- **ã¿ã‚“ãªãŒæ€ã†èª²é¡Œã®æ•´ç†**: `CitizenOpinionContent`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ279è¡Œç›®ï¼‰
- **ã¿ã‚“ãªã®æ„è¦‹**: `OtherOpinionCard`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ355-363è¡Œç›®ï¼‰

**DebatePointsContent.tsx**
- `debateData.axes`ã‚’è¡¨ç¤ºï¼ˆ42-60è¡Œç›®ï¼‰
- `debateData.agreementPoints`ã‚’è¡¨ç¤ºï¼ˆ63-78è¡Œç›®ï¼‰
- `debateData.disagreementPoints`ã‚’è¡¨ç¤ºï¼ˆ81-96è¡Œç›®ï¼‰

**CitizenOpinionContent.tsx**
- `digestDraft.content`ã‚’Markdownã¨ã—ã¦è¡¨ç¤º
- åŠ å·¥å‡¦ç†: ã€Œå¸‚æ°‘ã®æ„è¦‹ãƒ¬ãƒãƒ¼ãƒˆã€ã‚¿ã‚¤ãƒˆãƒ«å‰Šé™¤ã€ã€Œå•ã„ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‰Šé™¤ã€ã€Œæ¦‚è¦ã€â†’ã€Œã¾ã¨ã‚ã€ã«å¤‰æ›´ï¼ˆ29-40è¡Œç›®ï¼‰

**IllustrationSummaryContent.tsx**
- `visualReport`ãŒHTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å ´åˆã€iframeã§è¡¨ç¤ºï¼ˆ21-30è¡Œç›®ï¼‰
- `visualReport`ãŒç”»åƒURLã®å ´åˆã€imgã‚¿ã‚°ã§è¡¨ç¤ºï¼ˆ33-39è¡Œç›®ï¼‰

### âœ… ç¢ºèªçµæœ
- APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: æ­£å¸¸
- å‹å®šç¾©: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ä¸€è‡´
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°: æ­£å¸¸
- è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: é©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

---

## 5. çŸ›ç›¾ãƒ»å•é¡Œç‚¹ã®ç¢ºèª

### âœ… æ­£å¸¸ãªéƒ¨åˆ†

1. **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å…¨ä½“**: å•é¡Œãªã—
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ç­” â†’ Problem/SolutionæŠ½å‡º â†’ QuestionLinké–¢é€£ä»˜ã‘ â†’ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ â†’ è¡¨ç¤º

2. **APIãƒ‘ã‚¹**: å•é¡Œãªã—
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: `routes/themeQuestionRoutes.js` â†’ `controllers/questionController.js` â†’ `services/*.js`
   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: `apiClient.ts` â†’ `useQuestionDetail.ts` â†’ `QuestionDetail.tsx` â†’ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

3. **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°**: å•é¡Œãªã—
   - `overallAnalysis` â†’ `visualReport` â†’ `srcDoc`
   - `debateAnalysis` â†’ `debateData` â†’ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
   - `digestDraft` â†’ `digestDraft` â†’ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

4. **å‹å®šç¾©**: å•é¡Œãªã—
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ä¸€è‡´

### âš ï¸ æ½œåœ¨çš„ãªå•é¡Œç‚¹

1. **DigestDraftã®ä¾å­˜é–¢ä¿‚**
   - **å•é¡Œ**: `DigestDraft`ã®ç”Ÿæˆã¯`PolicyDraft`ã®å­˜åœ¨ã«ä¾å­˜ã—ã¦ã„ã‚‹
   - **å½±éŸ¿**: `PolicyDraft`ãŒå­˜åœ¨ã—ãªã„å ´åˆã€`DigestDraft`ãŒç”Ÿæˆã•ã‚Œãªã„
   - **ç¾çŠ¶**: æ„å›³çš„ãªè¨­è¨ˆï¼ˆä¾å­˜é–¢ä¿‚ãŒæ˜ç¢ºï¼‰

2. **visualReportã®å‹å®šç¾©**
   - **å•é¡Œ**: `visualReport: string`ã¨å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒã€å®Ÿéš›ã«ã¯`string | null`ã®å¯èƒ½æ€§ãŒã‚ã‚‹
   - **å½±éŸ¿**: TypeScriptã®å‹ãƒã‚§ãƒƒã‚¯ã§è­¦å‘ŠãŒå‡ºã‚‹å¯èƒ½æ€§
   - **æ¨å¥¨**: `visualReport: string | null`ã«å¤‰æ›´

3. **debateDataã®å–å¾—æ–¹æ³•**
   - **å•é¡Œ**: `getDebateAnalysis`ãŒ`.lean()`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€`getQuestionDetails`å†…ã§ã‚‚ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹
   - **å½±éŸ¿**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯å•é¡Œãªã—ï¼ˆ`.lean()`ã¯æ­£ã—ã„ä½¿ç”¨ï¼‰

4. **é«˜ã•ã®ä¸ä¸€è‡´ï¼ˆã‚¤ãƒ©ã‚¹ãƒˆè¦ç´„ï¼‰**
   - **å•é¡Œ**: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§1440pxä»¥ä¸Šã‚’æŒ‡å®šã—ã¦ã„ã‚‹ãŒã€iframeãŒ600-800pxã«å›ºå®š
   - **å½±éŸ¿**: iframeå†…ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãŒå¿…è¦ï¼ˆç¾çŠ¶ã¯å•é¡Œãªã—ï¼‰

### ğŸ”§ æ¨å¥¨ä¿®æ­£

1. **visualReportã®å‹å®šç¾©ã‚’ä¿®æ­£**
   ```typescript
   visualReport: string | null;
   ```

2. **DigestDraftã®ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¢ºåŒ–**
   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§`PolicyDraft`ã®å­˜åœ¨ã‚’ç¢ºèªã™ã‚‹å‡¦ç†ã‚’è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

## 6. CSSè¨­å®šã®ç¢ºèª

### 6.1 è«–ç‚¹ã¾ã¨ã‚ï¼ˆDebatePointsContentï¼‰

**CSSã‚¯ãƒ©ã‚¹**:
- è¦‹å‡ºã—: `text-2xl font-bold text-gray-800`
- å¯¾ç«‹è»¸ã‚¿ã‚¤ãƒˆãƒ«: `text-xl font-bold text-gray-800 mb-2`
- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ©ãƒ™ãƒ«: `font-bold text-gray-800 mb-1`
- æœ¬æ–‡: `text-gray-800 leading-8`
- åˆæ„ç‚¹/å¯¾ç«‹ç‚¹: `text-gray-800 leading-8 flex gap-2`

### 6.2 æ„è¦‹ã¾ã¨ã‚ï¼ˆCitizenOpinionContentï¼‰

**CSSã‚¯ãƒ©ã‚¹**:
- æœ¬æ–‡: `text-gray-800 leading-8`
- Markdownãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°: `MarkdownRenderer`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨

### 6.3 ã‚¤ãƒ©ã‚¹ãƒˆè¦ç´„ï¼ˆIllustrationSummaryContentï¼‰

**CSSã‚¯ãƒ©ã‚¹**:
- iframe: `w-full h-full border-0 rounded-2xl`
- ç”»åƒ: `max-w-full max-h-full object-contain rounded-2xl`
- ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼: `bg-gray-300 rounded-2xl`

**ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæŒ‡å®š**:
- ãƒ•ã‚©ãƒ³ãƒˆ: Zen Maru Gothic
- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¹…: 375pxï¼ˆä¸­å¤®æƒãˆï¼‰
- é«˜ã•: 1440pxä»¥ä¸Š
- margin: 0, padding: 2px

### âœ… ç¢ºèªçµæœ
- CSSè¨­å®š: ä¸€è²«æ€§ã‚ã‚Š
- ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ : Tailwind CSSã§çµ±ä¸€ã•ã‚Œã¦ã„ã‚‹
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®CSS: ç«¶åˆãªã—ï¼ˆiframeã¯ç‹¬ç«‹ã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰

---

## 7. ãƒ‘ã‚¹ç¢ºèª

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

#### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- âœ… `routes/themeQuestionRoutes.js` â†’ `/api/themes/:themeId/questions/:questionId/*`
- âœ… `routes/questionRoutes.js` â†’ `/api/questions/*`
- âœ… `routes/themeRoutes.js` â†’ `/api/themes/*`

#### ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
- âœ… `controllers/questionController.js` â†’ `getQuestionDetails`, `trigger*Generation`
- âœ… `controllers/chatController.js` â†’ `handleNewMessageByTheme`
- âœ… `controllers/adminController.js` â†’ ä¸€æ‹¬ç”Ÿæˆå‡¦ç†

#### ã‚µãƒ¼ãƒ“ã‚¹
- âœ… `services/debateAnalysisGenerator.js` â†’ `generateDebateAnalysis`, `getDebateAnalysis`
- âœ… `services/questionVisualReportGenerator.js` â†’ `generateQuestionVisualReport`, `getVisualReport`
- âœ… `workers/digestGenerator.js` â†’ `generateDigestDraft`
- âœ… `workers/policyGenerator.js` â†’ `generatePolicyDraft`

#### ãƒ¯ãƒ¼ã‚«ãƒ¼
- âœ… `workers/extractionWorker.js` â†’ Problem/SolutionæŠ½å‡º
- âœ… `workers/debateAnalysisGenerator.js` â†’ è«–ç‚¹ã¾ã¨ã‚ç”Ÿæˆã‚¿ã‚¹ã‚¯
- âœ… `workers/visualReportGenerator.js` â†’ ã‚¤ãƒ©ã‚¹ãƒˆè¦ç´„ç”Ÿæˆã‚¿ã‚¹ã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

#### APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- âœ… `services/api/apiClient.ts` â†’ `getQuestionDetails`
- âœ… `services/api/httpClient.ts` â†’ HTTPé€šä¿¡

#### ãƒ•ãƒƒã‚¯
- âœ… `hooks/useQuestionDetail.ts` â†’ `useQuestionDetail`
- âœ… `hooks/useThemeDetail.ts` â†’ `useThemeDetail`

#### ãƒšãƒ¼ã‚¸
- âœ… `pages/QuestionDetail.tsx` â†’ è³ªå•è©³ç´°ãƒšãƒ¼ã‚¸

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- âœ… `components/question/DebatePointsContent.tsx` â†’ è«–ç‚¹ã¾ã¨ã‚è¡¨ç¤º
- âœ… `components/question/CitizenOpinionContent.tsx` â†’ æ„è¦‹ã¾ã¨ã‚è¡¨ç¤º
- âœ… `components/question/IllustrationSummaryContent.tsx` â†’ ã‚¤ãƒ©ã‚¹ãƒˆè¦ç´„è¡¨ç¤º
- âœ… `components/question/OtherOpinionCard.tsx` â†’ æ„è¦‹ã‚«ãƒ¼ãƒ‰

### âœ… ç¢ºèªçµæœ
- ãƒ‘ã‚¹: ã™ã¹ã¦æ­£å¸¸
- ã‚¤ãƒ³ãƒãƒ¼ãƒˆ: æ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ä¸€è‡´

---

## 8. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å…¨ä½“å›³

```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼]
    â†“ ãƒãƒ£ãƒƒãƒˆã§æ„è¦‹æŠ•ç¨¿
[ChatThread] (ä¿å­˜)
    â†“ AIæŠ½å‡º
[Problem/Solution] (ä¿å­˜)
    â†“ QuestionLinkã§é–¢é€£ä»˜ã‘
[QuestionLink] (ä¿å­˜)
    â†“ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒˆãƒªã‚¬ãƒ¼
[AIç”Ÿæˆ]
    â”œâ”€â†’ [DebateAnalysis] (è«–ç‚¹ã¾ã¨ã‚)
    â”œâ”€â†’ [PolicyDraft] (æ”¿ç­–ãƒ‰ãƒ©ãƒ•ãƒˆ)
    â”œâ”€â†’ [DigestDraft] (æ„è¦‹ã¾ã¨ã‚) â† PolicyDraftã«ä¾å­˜
    â””â”€â†’ [QuestionVisualReport] (ã‚¤ãƒ©ã‚¹ãƒˆè¦ç´„)
    â†“ APIå–å¾—
[ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰]
    â”œâ”€â†’ DebatePointsContent (è¡¨ç¤º)
    â”œâ”€â†’ CitizenOpinionContent (è¡¨ç¤º)
    â””â”€â†’ IllustrationSummaryContent (è¡¨ç¤º)
```

---

## 9. ã¾ã¨ã‚

### âœ… æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹éƒ¨åˆ†

1. **ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å…¨ä½“**: å•é¡Œãªã—
2. **APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: æ­£å¸¸
3. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨è¡¨ç¤º**: æ­£å¸¸
4. **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°**: æ­£å¸¸
5. **å‹å®šç¾©**: ã»ã¼æ­£å¸¸ï¼ˆvisualReportã®å‹ã®ã¿è¦ä¿®æ­£ï¼‰
6. **CSSè¨­å®š**: ä¸€è²«æ€§ã‚ã‚Š

### âš ï¸ æ”¹å–„ãŒå¿…è¦ãªéƒ¨åˆ†

1. **visualReportã®å‹å®šç¾©**: `string | null`ã«å¤‰æ›´æ¨å¥¨
2. **é«˜ã•ã®ä¸ä¸€è‡´ï¼ˆã‚¤ãƒ©ã‚¹ãƒˆè¦ç´„ï¼‰**: ç¾çŠ¶ã¯å•é¡Œãªã—ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ï¼‰
3. **DigestDraftã®ä¾å­˜é–¢ä¿‚**: æ„å›³çš„ãªè¨­è¨ˆï¼ˆå•é¡Œãªã—ï¼‰

### ğŸ”§ æ¨å¥¨ä¿®æ­£

1. **å‹å®šç¾©ã®ä¿®æ­£**
   ```typescript
   // frontend/src/hooks/useQuestionDetail.ts
   visualReport: string | null;
   ```

2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–**ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   - å„ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’çµ±ä¸€

### é‡å¤§ãªå•é¡Œ
**ãªã—**ã€‚å…¨ä½“çš„ã«æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã€‚

---

## 10. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ç­” â†’ Problem/SolutionæŠ½å‡º
- [x] Problem/Solution â†’ QuestionLinké–¢é€£ä»˜ã‘
- [x] QuestionLink â†’ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- [x] ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ â†’ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜
- [x] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ â†’ APIå–å¾—
- [x] API â†’ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤º

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- [x] GET `/api/themes/:themeId/questions/:questionId/details`
- [x] POST `/api/themes/:themeId/questions/:questionId/generate-*`
- [x] ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š

### å‹å®šç¾©
- [x] ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ 
- [x] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‹å®šç¾©
- [x] ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°

### CSSè¨­å®š
- [x] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ«
- [x] ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã®ä¸€è²«æ€§
- [x] ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæŒ‡å®šã¨ã®æ•´åˆæ€§

### ãƒ‘ã‚¹
- [x] ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- [x] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰APIå‘¼ã³å‡ºã—
- [x] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¤ãƒ³ãƒãƒ¼ãƒˆ
